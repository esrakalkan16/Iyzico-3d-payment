@model Iyzico3DPayment.Services.Iyzico3DPaymentService.Init3DPaymentRequest

@{
    ViewBag.Title = "Ödeme Bilgileri";
}

<div class="container my-5 d-flex justify-content-center">
    <div class="card shadow-lg p-4 w-100" style="max-width: 1000px;">
        <h3 class="text-center mb-4">
            <i class="bi bi-credit-card text-warning"></i>
            <strong>Ödeme Bilgileri</strong>
        </h3>

        @using (Html.BeginForm("Init", "Payment", FormMethod.Post))
        {
            <div class="row gap-4">

                <!-- Kart Bilgileri Kutusu -->
                <div class="col-md bg-light border rounded p-4">
                    <h5 class="mb-3 text-secondary">Kart Bilgileri</h5>

                    <div class="mb-3">
                        <label>Kart Üzerindeki İsim</label>
                        <input type="text" name="paymentCard.cardHolderName" class="form-control"
                               placeholder="Ad Soyad"
                               pattern="^[A-Za-zÇçĞğİıÖöŞşÜü\s]{3,40}$"
                               title="Yalnızca harf giriniz (3-40 karakter)"
                               required />
                    </div>

                    <div class="mb-3">
                        <label>Kart Numarası</label>
                        <input type="text" name="paymentCard.cardNumber" id="cardNumber" class="form-control"
                               placeholder="0000 0000 0000 0000"
                               maxlength="19"
                               required />
                    </div>

                    <div class="form-group d-flex justify-content-between gap-2">
                        <div style="flex: 1;">
                            <label for="expireMonth">Son Kullanma Ayı</label>
                            <select class="form-control" id="expireMonth" name="paymentCard.expireMonth" required>
                                <option disabled selected>Ay</option>
                                @for (int i = 1; i <= 12; i++)
                                {
                                    <option value="@i.ToString("D2")">@i.ToString("D2")</option>
                                }
                            </select>
                        </div>

                        <div style="flex: 1;">
                            <label for="expireYear">Son Kullanma Yılı</label>
                            <input type="text"
                                   id="expireYear"
                                   name="paymentCard.expireYear"
                                   class="form-control"
                                   maxlength="4"
                                   pattern="\d{4}"
                                   placeholder="YYYY"
                                   inputmode="numeric"
                                   oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0,4);"
                                   required />
                        </div>
                    </div>
                    <div class="mb-3">
                        <label>CVC</label>
                        <input type="text"
                               id="cvc"
                               name="paymentCard.cvc"
                               class="form-control"
                               placeholder="123"
                               maxlength="3"
                               inputmode="numeric"
                               pattern="\d{3,4}"
                               oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0,4);"
                               required />
                    </div>
                </div>

                <!-- Tutar Bilgileri Kutusu -->
                <div class="col-md bg-light border rounded p-4">
                    <h5 class="mb-3 text-secondary">Tutar Bilgileri</h5>

                    <div class="mb-3">
                        <label>Ürün Tutarı</label>
                        <input type="number" name="price" class="form-control" min="0" step="0.01" required />
                    </div>

                    <div class="mb-3">
                        <label>Ödenecek Tutar</label>
                        <input type="number" name="paidPrice" class="form-control" min="0" step="0.01" required />
                    </div>

                    <div class="mb-3">
                        <label>Taksit Sayısı</label>
                        <select name="installment" class="form-control" required>
                            <option value="1">Tek Çekim</option>
                            <option value="2">2 Taksit</option>
                            <option value="3">3 Taksit</option>
                            <option value="6">6 Taksit</option>
                            <option value="9">9 Taksit</option>
                            <option value="12">12 Taksit</option>
                        </select>
                    </div>

                    <button type="submit" class="btn btn-primary w-100 mt-4">
                        <i class="bi bi-credit-card-2-back-fill me-2"></i>Ödemeyi Başlat
                    </button>
                </div>

            </div>
        }
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const cardInput = document.getElementById("cardNumber");

        cardInput.addEventListener("input", function (e) {
            let value = e.target.value.replace(/\D/g, "").substring(0, 16);
            let formatted = value.match(/.{1,4}/g)?.join(" ") ?? "";
            e.target.value = formatted;
        });
    });
</script>